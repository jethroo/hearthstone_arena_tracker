(function() {
  "use strict";
  angular.module('ng_hat', []);

  angular.module("ng_hat").controller("MatchesController", function($scope, MatchesFactory ) {
    $scope.matchesFactory = MatchesFactory;
    $scope.matches = $scope.matchesFactory.getMatches();
  });

  angular.module("ng_hat").factory("MatchesFactory", function() {
    var matches = [];
    var counter = 1;
    for (var i = 0; i < 100; i++) {
      counter += 1;
      matches.push({ number: counter, arena_link: "foo" });
    };

    return {
      getMatches: function() {
        return matches;
      },
      loadMore: function() {
        for (var i = 0; i < 5; i++) {
          counter += 1;
          matches.push({ number: counter });
        }
      }
    };
  });

  angular.module("ng_hat").directive('whenScrolled', function() {
    return function(scope, elm, attr) {
      var raw = elm[0];

      elm.bind('scroll', function() {
        if (raw.scrollTop + raw.offsetHeight >= raw.scrollHeight - 10) {
          scope.$apply(attr.whenScrolled);
        }
      });
    };
  });

}());
